<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewmodel="clr-namespace:DimensionsTagUtility"
             x:Class="DimensionsTagUtility.TagUtilityPage" BackgroundImageSource="mainbgnd.png"
             x:DataType="viewmodel:TagPageViewModel"
             xmlns:convert ="clr-namespace:DimensionsTagUtility.Tools"
             x:Name="TagPage">
    <ContentPage.Resources>
        <ResourceDictionary>
            <convert:ByteArrayToStringConverter x:Key="ArrayToString" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <Border 
            VerticalOptions="Center"
            Background="#0f0f0f80"                
            StrokeShape="{RoundRectangle CornerRadius=20}"
            Margin="10"
            Padding="5" >

            <VerticalStackLayout>
                <VerticalStackLayout.Margin>
                    <OnIdiom x:TypeArguments="Thickness">
                        <OnIdiom.Phone>0,0,0,0</OnIdiom.Phone>
                        <OnIdiom.Tablet>0,0,0,0</OnIdiom.Tablet>
                        <OnIdiom.Desktop>0,0,20,0</OnIdiom.Desktop>
                    </OnIdiom>
                </VerticalStackLayout.Margin>

                <Label   
                    HorizontalOptions="Center"
                    FontSize="Large"
                    TextColor="White"                    
                    FontAttributes="Bold"
                    Text="Get Toy tag info." 
                    TextDecorations="Underline"
                    Margin="0,10,0,10">
                    <Label.Shadow>
                        <Shadow
                             Brush="DimGray"
                             Offset="5,5"
                             Radius="5"
                             Opacity=".8" />
                    </Label.Shadow>
                </Label>

                <Grid 
                    ColumnDefinitions="15*,85*"
                    Padding="2">

                    <Label
                    Grid.Column="0"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    HorizontalTextAlignment="Center"
                    Text="Uid:"/>

                    <Border
                        Grid.Column="1"
                        HorizontalOptions="Fill"
                        StrokeShape="{RoundRectangle CornerRadius=5}"
                        Background="#161616" 
                        Padding="2" >

                        <Entry 
                            Grid.Column="1"
                            x:Name="UidEntry"
                            Placeholder="Enter Uid.."
                            PlaceholderColor="LightGray"
                            TextColor="White"                           
                            Text=""                               
                            MaxLength="20" >
                            <Entry.Behaviors>
                                <toolkit:MaskedBehavior 
                                    Mask="##:##:##:##:##:##:##"
                                    UnmaskedCharacter="#" 
                                    />
                                <toolkit:EventToCommandBehavior 
                                                EventName="TextChanged"
                                                Command="{Binding UidTextChangedCommand}"
                                                CommandParameter="{Binding Source={x:Reference UidEntry}, Path=Text}"
                                                BindingContext="{x:Reference TagPage}" />
                            </Entry.Behaviors>
                        </Entry>
                    </Border>
                </Grid>

                <Label 
                    Text="{Binding UidError}"                    
                    TextColor="Red"
                    IsVisible="true"                     
                    HorizontalOptions="Center"
                    Margin="0,0,0,10"/>

                <Grid ColumnDefinitions="15*,85*"
                      Padding="2">

                    <Label
                        Grid.Column="0"
                        VerticalOptions="Center"
                        HorizontalTextAlignment="Center"
                        Text="Search:"/>

                    <Border                   
                        Grid.Column="1"
                        VerticalOptions="Start"
                        StrokeShape="{RoundRectangle CornerRadius=5}"
                        Background="#161616"                        
                        Padding="2" >

                        <SearchBar 
                            Grid.Column="1"
                            x:Name="searchBar"                          
                            Placeholder="Search for desired tag.."
                            Text="{Binding Query}"
                            HorizontalTextAlignment="Start"                      
                            TextColor="White"                   
                            BackgroundColor="#161616"
                            PlaceholderColor="LightGray"
                            CancelButtonColor="#01a7d3" 
                            SearchCommand="{Binding SearchCommand}" >

                        </SearchBar>
                    </Border>
                </Grid>

                <Grid 
                    ColumnDefinitions="25*,75*"
                    Padding="10"
                    Margin="0,0,0,10">

                    <Label
                        x:Name="lbl_results"
                        Grid.Column="0"
                        Text="{Binding Results}"                   
                        TextDecorations="Underline"
                        HorizontalTextAlignment="Start"
                        TextColor="White" />

                    <Label 
                        Grid.Column="1"
                        HorizontalOptions="Center"
                        Text="{Binding SearchError}"
                        TextColor="Red"
                        IsVisible="true"  />

                </Grid>

                <CollectionView
                    x:Name="searchResults"
                    ItemsSource="{Binding ListItems}"
                    IsVisible="{Binding IsDisplayed}"
                    SelectionMode="None"
                    VerticalOptions="Start"
                    MaximumHeightRequest="200">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodel:SearchItems">
                            <Label Text="{Binding ItemName}"
                                   FontSize="16"
                                   Padding="8">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer 
                                     Command="{Binding BindingContext.ItemSelectedCommand, Source={x:Reference searchResults}}" 
                                     CommandParameter="{Binding ItemName}" />
                                </Label.GestureRecognizers>
                            </Label>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Grid    
                    ColumnDefinitions="20*,80*"
                    Padding="5" >

                    <Label   
                        VerticalOptions="Center"
                        HorizontalOptions="Center"
                        Grid.Column="0"
                        Text="Page 0x24:"/>

                    <Entry 
                         Grid.Column="1"                       
                         Text="{Binding Page0x24, Mode=OneWay, Converter={StaticResource ArrayToString}}"
                         IsReadOnly="True" >
                        <Entry.Triggers>
                            <DataTrigger TargetType="Entry" 
                                         Binding="{Binding Source={x:Reference UidEntry}, Path=Text.Length}"
                                         Value="0">
                                <Setter Property="Text"
                                        Value=""/>
                            </DataTrigger>
                        </Entry.Triggers>
                    </Entry>
                </Grid>

                <Grid    
                    ColumnDefinitions="20*,80*"
                    Padding="5">

                    <Label   
                        VerticalOptions="Center"
                        HorizontalOptions="Center"
                        Grid.Column="0"
                        Text="Page 0x25:"/>

                    <Entry
                        Grid.Column="1"
                        Text="{Binding Page0x25, Mode=OneWay, Converter={StaticResource ArrayToString}}"
                        IsReadOnly="True" >
                        <Entry.Triggers>
                            <DataTrigger TargetType="Entry" 
                                         Binding="{Binding Source={x:Reference UidEntry}, Path=Text.Length}"
                                         Value="0">
                                <Setter Property="Text"
                                        Value=""/>
                            </DataTrigger>
                        </Entry.Triggers>
                    </Entry>
                </Grid>

                <Grid    
                    ColumnDefinitions="20*,80*"
                    Padding="5">

                    <Label   
                         VerticalOptions="Center"
                         HorizontalOptions="Center"
                         Grid.Column="0"
                         Text="Page 0x26:"/>

                    <Entry 
                         Grid.Column="1"
                         Text="{Binding Page0x26, Mode=OneWay, Converter={StaticResource ArrayToString}}"
                         IsReadOnly="True" >
                        <Entry.Triggers>
                            <DataTrigger TargetType="Entry" 
                                         Binding="{Binding Source={x:Reference UidEntry}, Path=Text.Length}"
                                         Value="0">
                                <Setter Property="Text"
                                        Value=""/>
                            </DataTrigger>
                        </Entry.Triggers>
                    </Entry>
                </Grid>

                <Grid    
                    ColumnDefinitions="20*,80*"
                    Padding="5"
                    Margin="0,0,0,10">

                    <Label   
                        VerticalOptions="Center"
                        HorizontalOptions="Center"
                        Grid.Column="0"
                        Grid.Row="3"
                        Text="Page 0x2B:"/>

                    <Entry
                        Grid.Column="1"
                        Grid.Row="3"
                        Text="{Binding Page0x2b, Mode=OneWay, Converter={StaticResource ArrayToString}}"
                        IsReadOnly="True">
                        <Entry.Triggers>
                            <DataTrigger TargetType="Entry" 
                                         Binding="{Binding Source={x:Reference UidEntry}, Path=Text.Length}"
                                         Value="0">
                                <Setter Property="Text"
                                        Value=""/>
                            </DataTrigger>
                        </Entry.Triggers>
                    </Entry>
                </Grid>
                <Button
                    Command="{Binding CopyPagesCommand}"
                    HorizontalOptions="Center"
                    BackgroundColor="#161616"
                    TextColor="White"                  
                    Text="Copy All?"
                    FontAttributes="Bold"  
                    Margin="0,0,0,10" >
                    <Button.Shadow>
                        <Shadow
                            Brush="DimGray"
                            Offset="3,3"
                            Radius="5"
                            Opacity=".8" />
                    </Button.Shadow>
                </Button>
            </VerticalStackLayout>
        </Border>
    </ScrollView>
</ContentPage>